#!/bin/sh

InD=,

C='[1-9][0-9]*'
P='\['"${C:?}${InD:?}${C:?}"']'

p1() {
    : "${1:?}"
    echo "${1:?}" | sed 's/^\('"${P:?}"'\)'"${P:?}"'$/\1/'
}

p2() {
    : "${1:?}"
    echo "${1:?}" | sed 's/^'"${P:?}"'\('"${P:?}"'\)$/\1/'
}

x() {
    : "${1:?}"
    echo "${1:?}" | sed 's/^\[\('"${C:?}"'\)'"${InD:?}${C:?}"']$/\1/'
}

y() {
    : "${1:?}"
    echo "${1:?}" | sed 's/^\['"${C:?}${InD:?}"'\('"${C:?}"'\)]$/\1/'
}

mean() {
    : "${1:?}"
    : "${2:?}"
    { echo "${1:?}" | grep -q '^'"${C:?}"'$'; } || exit 65
    { echo "${2:?}" | grep -q '^'"${C:?}"'$'; } || exit 65
    echo $(((${1:?}+${2:?})/2))
}

OutD="${1-${InD:?}}"
: "${OutD:?}"

In="$(head -n 1)"  # Example: `[442,2088][602,2132]`.
: "${In:?}"

{ echo "${In:?}" \
      | grep -q '^'"${P:?}${P:?}"'$'; } \
    || exit 65

P1=$(p1 "${In:?}") || exit 1
X1=$(x "${P1:?}") || exit 1
Y1=$(y "${P1:?}") || exit 1

P2=$(p2 "${In:?}") || exit 1
X2=$(x "${P2:?}") || exit 1
Y2=$(y "${P2:?}") || exit 1

X=$(mean ${X1:?} ${X2:?}) || exit 1
Y=$(mean ${Y1:?} ${Y2:?}) || exit 1

echo ${X:?}"${OutD:?}"${Y:?}  # Example: `522,2110`.
